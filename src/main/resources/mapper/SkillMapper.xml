<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kr.setsu.mapper.SkillMapper">
	<resultMap id="SkillCatogriesMap"
		type="com.kr.setsu.entity.SkillCatogries">
		<result property="skillCatogry" column="category_name" />
		<collection property="skills"
			ofType="com.kr.setsu.entity.SkillInfo">
			<result property="skillName" column="skill_name" />
			<result property="selectedLevel" column="skill_selectedLevel" />
		</collection>
	</resultMap>

	<select id="getSkillCategoryByUserId"
		resultMap="SkillCatogriesMap">
		SELECT c.category_name, i.skill_name, i.skill_selectedLevel
		FROM user_skill_category c
		JOIN user_skill_item i ON c.id =
		i.category_id
		WHERE c.user_id = #{userId}
	</select>

	<update id="updateSkillCatogory" parameterType="com.kr.setsu.entity.SkillUpdate">
		UPDATE user_skill_item
		SET skill_selectedLevel = #{selectedLevel}
		WHERE skill_name = #{skillName}
		AND category_id = (
		SELECT id FROM user_skill_category
		WHERE user_id = #{userId}
		AND category_name = #{skillCatogry}
		)
	</update>

</mapper>